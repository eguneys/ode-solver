var W=Object.defineProperty;var J=(n,t,e)=>t in n?W(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>(J(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const _ of r.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&i(_)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const O=class{constructor(t,e,i){o(this,"ctx");this.width=t,this.height=e,this.canvas=i,this.ctx=i.getContext("2d")}clear(){this.ctx.clearRect(0,0,this.width,this.height)}tr(t,e,i,s,r){this.ctx.translate(t,e),this.ctx.rotate(r),this.ctx.translate(-i,-s)}resetTransform(){this.ctx.resetTransform()}fr(t,e,i,s,r){this.ctx.fillStyle=t,this.ctx.fillRect(e,i,s,r)}line(t,e,i,s,r,_){this.ctx.strokeStyle=t,this.ctx.lineWidth=e,this.ctx.beginPath(),this.ctx.moveTo(i,s),this.ctx.lineTo(r,_),this.ctx.closePath(),this.ctx.stroke()}};let z=O;o(z,"make",(t,e,i)=>{let s=document.createElement("canvas");return s.width=t,s.height=e,i.appendChild(s),new O(t,e,s)});const H=n=>{let t,e=0;function i(s){let r=s-(e||s);e=s,r=Math.max(Math.min(r,16),4),n(r),t=requestAnimationFrame(i)}return t=requestAnimationFrame(i),()=>{cancelAnimationFrame(t)}},l=class{constructor(t,e){o(this,"x");o(this,"y");this.x=t,this.y=e}get key(){return[this.x,this.y].join(";")}static get unit(){return new l(1,1)}static get zero(){return new l(0,0)}static get left(){return new l(-1,0)}static get right(){return new l(1,0)}static get up(){return new l(0,-1)}static get down(){return new l(0,1)}get sign(){return l.make(Math.sign(this.x),Math.sign(this.y))}get floor(){return l.make(Math.floor(this.x),Math.floor(this.y))}get neighbours(){return[l.up,l.down,l.left,l.right].map(t=>t.add(this))}get right(){return l.right.add(this)}get left(){return l.left.add(this)}get up(){return l.up.add(this)}get down(){return l.down.add(this)}get vs(){return[this.x,this.y]}get mul_inverse(){return new l(1/this.x,1/this.y)}get inverse(){return new l(-this.x,-this.y)}get half(){return new l(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){if(this.length!==0)return this.scale(1/this.length)}get perpendicular(){return new l(-this.y,this.x)}get clone(){return new l(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let e=t.length_squared,i=this.dot(t);return l.make(i*t.x/e,i*t.y/e)}distance(t){return this.sub(t).length}addy(t){return l.make(this.x,this.y+t)}add_angle(t){return l.from_angle(this.angle+t)}scale(t){let{clone:e}=this;return e.scale_in(t)}scale_in(t){return this.x*=t,this.y*=t,this}add(t){let{clone:e}=this;return e.add_in(t)}add_in(t){return this.x+=t.x,this.y+=t.y,this}sub(t){let{clone:e}=this;return e.sub_in(t)}sub_in(t){return this.x-=t.x,this.y-=t.y,this}mul(t){let{clone:e}=this;return e.mul_in(t)}mul_in(t){return this.x*=t.x,this.y*=t.y,this}div(t){let{clone:e}=this;return e.div_in(t)}div_in(t){return this.x/=t.x,this.y/=t.y,this}set_in(t,e=this.y){return this.x=t,this.y=e,this}};let h=l;o(h,"from_key",t=>new l(parseFloat(t.split(";")[0]),parseFloat(t.split(";")[1]))),o(h,"from_angle",t=>new l(Math.cos(t),Math.sin(t))),o(h,"make",(t,e)=>new l(t,e));class Y{constructor(t,e,i=new Map,s=new Map){this.w=t,this.h=e,this._map=i,this._o_by_body=s}get clone(){return new Y(this.w,this.h,new Map(this._map),new Map(this._o_by_body))}get bodies(){return[...this._o_by_body].map(([t,e])=>[t,t.map(i=>i.add(e))])}move_(t,e){if(!this._w_body(e).map(s=>t.add(s)).find(s=>{let r=this.on(s);return r&&r!==e})){let s=this._o_by_body.get(e),{clone:r}=this;return r.remove_body(e),r.body(s.add(t),e),r}}_w_body(t){let e=this._o_by_body.get(t);return t.map(i=>i.add(e))}on(t){return this._map.get(t.key)}remove_body(t){let e=this._o_by_body.get(t);t.forEach(i=>this._map.delete(e.add(i).key)),this._o_by_body.delete(t)}body(t,e){let i=e.map(s=>s.add(t)).map(s=>[s.key,e]);return i.forEach(([s,r])=>this._map.set(s,r)),this._o_by_body.set(e,t),i.map(s=>h.from_key(s[0]))}}const Q={"#":[h.zero],o:[h.zero],n:[h.zero,h.zero.right],l:[h.zero,h.zero.down],g:[h.zero,h.zero.right,h.zero.down,h.zero.right.down]},P=class{constructor(t,e){this.grid=t,this.info_by_body=e}get bodies(){return this.grid.bodies.map(([t,e])=>[this.info_by_body.get(t),e])}with_grid(t){return new P(t,this.info_by_body)}};let S=P;o(S,"from_fen",t=>{var d;let e=0,i=0,s=new Map;t.split(`
`).forEach((c,u)=>{e=u+1,c.split("").forEach((f,g)=>{i=g+1,s.set(h.make(g,u).key,f)})});let r=new Y(e,i),_=new Map,a=[];for(let[c,u]of s){if(a.includes(c))continue;let f=h.from_key(c),g=(d=Q[u])==null?void 0:d.slice(0);if(!g)continue;r.body(f,g).forEach(m=>a.push(m.key)),_.set(g,{body:g,char:u})}return new P(r,_)});const w=1e3/60,k={seconds:60*w,half:30*w,thirds:20*w,lengths:15*w,sixth:10*w,five:5*w,three:3*w,one:1*w},X=class{constructor(t){o(this,"_bounds");this.$_=t}$clear_bounds(){this._bounds=void 0}get bounds(){return this._bounds||(this._bounds=this.$_.getBoundingClientRect()),this._bounds}get size(){let{bounds:t}=this;return h.make(t.width,t.height)}get orig(){let{bounds:t}=this;return h.make(t.x,t.y)}get_normal_at_abs_pos(t){let{orig:e,size:i}=this;return t.sub(e).div(i)}};let q=X;o(q,"make",t=>new X(t));const U=n=>{document.addEventListener("scroll",n,{capture:!0,passive:!0}),window.addEventListener("resize",n,{passive:!0})};function Z(n){var t;return n.clientX!==void 0&&n.clientY!==void 0?[n.clientX,n.clientY]:(t=n.targetTouches)!=null&&t[0]?[n.targetTouches[0].clientX,n.targetTouches[0].clientY]:[0,0]}class K{}o(K,"init",(t,e=document)=>{const i=m=>{let y=Z(m);return y?h.make(y[0],y[1]):h.zero};let{_onDragStart:s,_onDragMove:r,_onDragEnd:_,_onContextMenu:a,_onWheel:d}=t;const c=m=>{s==null||s(i(m),m.buttons===2||m.button===2)},u=m=>{r==null||r(i(m))},f=m=>{_==null||_(i(m))},g=m=>{a&&(m.preventDefault(),a())},v=m=>{d==null||d(Math.sign(m.deltaY))};return e.addEventListener("wheel",v),e.addEventListener("touchstart",c,{passive:!1}),e.addEventListener("mousedown",c,{passive:!1}),e.addEventListener("contextmenu",g),document.addEventListener("mousemove",u,{passive:!1}),document.addEventListener("mouseup",f),document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",f),()=>{e.removeEventListener("wheel",v),e.removeEventListener("touchstart",c),e.removeEventListener("mousedown",c),e.removeEventListener("contextmenu",g),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",f)}});const G=(n,t)=>{let{on_hover:e,on_up:i,on_click:s,on_drag:r,on_context:_}=n,a,d,c,u;const f=g=>g&&{...g};return K.init({..._?{_onContextMenu(){_==null||_()}}:{},_onDragStart(g,v){d=f(a),a={e:g,_right:v},u&&(u==null||u()),u=H(m=>{a?((a.m||c&&a.e.distance(c)>3)&&(a.m=c),r==null||r(a,d),d=f(a)):u==null||u()})},_onDragMove(g){c=g,a||e==null||e(g)},_onDragEnd(){!a||(a.m||s==null||s(a.e,a._right),i==null||i(a.m||a.e,a._right),u==null||u(),u=void 0,a=void 0,c=void 0)}},t)},D=class{constructor(t,e,i=0){o(this,"_completed");o(this,"_i");o(this,"_t");o(this,"_value");this._values=t,this._durations=e,this.loop=i}get value(){return this._value}get i(){let t=this._durations[this._i%this._durations.length];return Math.min(this._t/t,1)}get completed(){return this._completed}complete_now(){this._value=this._values[this._values.length-1],this._completed=!0}update(t){if(this._completed)return;let{_values:e}=this;this._t+=t;let i=e[this._i],s=e[this._i+1],r=this.i;this._value=V(i,s,$(r)),r===1&&(this._i++,this._t=0,this._i>=e.length-1&&(this.loop===1?(this._i=0,this._values.reverse(),this._durations.reverse()):this._completed=!0))}init(){return this._i=0,this._t=0,this._completed=!1,this._value=this._values[0],this}};let b=D;o(b,"make_from_settings",t=>D.make(t.values,t.duration,t.loop)),o(b,"make",(t,e,i=!1)=>new D(t.slice(0),[e],i?1:0).init());function $(n){return n<.5?2*n*n:-1+(4-2*n)*n}const V=(n,t,e=.5)=>n*(1-e)+t*e;class p{constructor(t,e,i){this.x=t,this.y=e,this.z=i}dot2(t,e){return this.x*t+this.y*e}dot3(t,e,i){return this.x*t+this.y*e+this.z*i}}const tt=[new p(1,1,0),new p(-1,1,0),new p(1,-1,0),new p(-1,-1,0),new p(1,0,1),new p(-1,0,1),new p(1,0,-1),new p(-1,0,-1),new p(0,1,1),new p(0,-1,1),new p(0,1,-1),new p(0,-1,-1)],C=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],M=new Array(512),E=new Array(512),et=function(n){n>0&&n<1&&(n*=65536),n=Math.floor(n),n<256&&(n|=n<<8);for(var t=0;t<256;t++){var e;t&1?e=C[t]^n&255:e=C[t]^n>>8&255,M[t]=M[t+256]=e,E[t]=E[t+256]=tt[e%12]}};et(0);function N(n){return n*n*n*(n*(n*6-15)+10)}function A(n,t,e){return(1-e)*n+e*t}const j=function(n,t){var e=Math.floor(n),i=Math.floor(t);n=n-e,t=t-i,e=e&255,i=i&255;var s=E[e+M[i]].dot2(n,t),r=E[e+M[i+1]].dot2(n,t-1),_=E[e+1+M[i]].dot2(n-1,t),a=E[e+1+M[i+1]].dot2(n-1,t-1),d=N(n);return A(A(s,_,d),A(r,a,d),N(t))};class T{constructor(t,e,i,s=k.half){o(this,"_life");o(this,"value");o(this,"_fade");this._max=t,this._speed=e,this._direction=i,this._max_fade=s,this._life=0,this.value=h.zero,this._fade=this._max_fade}get x(){return this.value.x}get y(){return this.value.y}get completed(){return this._fade===0}_update(t){this._life+=t,this._fade>0&&(this._fade-=t,this._fade<0&&(this._fade=0));let e=Math.sin(this._speed*this._life),i=this._direction.add(h.make(j(Math.cos(this._life),Math.sin(this._life)),j(Math.sin(this._life),Math.cos(this._life))).scale(2)),s=this._fade/this._max_fade;this.value=i.scale(e*this._max*s)}}class F{constructor(t,e){o(this,"_next_state",this);this.drag_piece=t,this.o=e}get _is_down(){return this.drag_piece._is_down}get hooks(){return this.drag_piece.hooks}init(){return this.hooks.on_begin(this._type,this.o),this._init(),this}_init(){}_drag_end(){}_drag_move(t){}_update(t){}}class st extends F{constructor(e){super(e.drag_piece,e.o);o(this,"_type","slide-pass");o(this,"_tween");this._drag_test=e}get _drag_begin(){return this._drag_test._drag_begin}_init(){this._tween=b.make([.3,.8,1,1],k.five)}_update(e){if(this._tween.update(e),this._tween.completed)this.hooks.on_pass(),this._is_down?this._next_state=new R(this._drag_begin).init():this._next_state=void 0;else{let i=100*Math.sign(this._drag_begin._h)*this._tween.value,s=100*Math.sign(this._drag_begin._v)*this._tween.value;i=Math.max(-100,Math.min(100,i)),s=Math.max(-100,Math.min(100,s)),this.hooks.on_move(i,s)}}}class it extends F{constructor(e){super(e.drag_piece,e.o);o(this,"_type","slide-fail");o(this,"_shake");o(this,"_tween");this._drag_test=e}get _drag_begin(){return this._drag_test._drag_begin}_init(){this._shake=new T(3,1,h.left,k.sixth),this._tween=b.make([1,1,0],k.sixth)}_update(e){if(this._shake._update(e),this._tween.update(e),this._shake.completed||this.hooks.on_shake(this._shake),this._tween.completed)this._next_state=void 0;else{let i=this._drag_begin._h*this._tween.value,s=this._drag_begin._v*this._tween.value;i=Math.max(-30,Math.min(30,i)),s=Math.max(-30,Math.min(30,s)),this.hooks.on_move(i,s)}}}class R extends F{constructor(e){super(e.drag_piece,e.o);o(this,"_type","slide-test");o(this,"_tween");this._drag_begin=e}_drag_end(){}_init(){this._tween=b.make([0,1],k.five)}_update(e){this._tween.update(e);let i=this._drag_begin._h*this._tween.value,s=this._drag_begin._v*this._tween.value;i=Math.max(-30,Math.min(30,i)),s=Math.max(-30,Math.min(30,s)),this.hooks.on_move(i,s),this._tween.completed&&(this.hooks.on_test_move_(h.make(this._drag_begin._h,this._drag_begin._v).sign)?this._next_state=new st(this).init():this._next_state=new it(this).init())}}class nt extends F{constructor(){super(...arguments);o(this,"_v");o(this,"_h");o(this,"_type","begin");o(this,"_shake")}_drag_move(e){let i=this.o.sub(e),s=i.dot(h.left),r=i.dot(h.up),_=Math.abs(s),a=Math.abs(r);_>a?(this._shake||(this._shake=new T(1,1,h.left.scale(2*Math.sign(s)),k.three)),this._h=s,this._v=0):(this._shake||(this._shake=new T(1,1,h.up.scale(2*Math.sign(r)),k.three)),this._v=r,this._h=0)}_update(e){this._shake&&(this._shake._update(e),this._shake.completed&&(this._next_state=new R(this).init()),this.hooks.on_shake(this._shake))}}let rt=h.make(1080,1920),I=rt.scale(1);class ot{constructor(t,e){o(this,"_is_down");o(this,"_state");this.element=t,this.hooks=e;let i=q.make(t);U(()=>{i.$clear_bounds()}),this._is_down=!1;let s=this;G({on_context(){},on_drag(r,_){if(r.m){s._is_down=!0;let a=i.get_normal_at_abs_pos(r.e).mul(I),d=i.get_normal_at_abs_pos(r.m).mul(I);if(s._state)s._state._drag_move(d);else{let c=d.scale(.01).floor;e.on_test_drag(c)&&(s._state=new nt(s,a).init())}}},on_up(){s._is_down=!1}},t)}_update(t){this._state&&(this._state._update(t),this._state=this._state._next_state,this._state||this.hooks.on_end())}}let ht=`
# ########
  #nno.o.#
  #logglo#
  #logglo#
  ###.####
`;const B={"#":"hsl(0, 20%, 80%)",o:"hsl(10, 60%, 60%)",n:"hsl(40, 60%, 60%)",l:"hsl(80, 60%, 60%)",g:"hsl(90, 60%, 60%)"};let at=h.make(1080,1920);at.scale(1);let x=100;const lt=n=>{let t=z.make(1080,1920,n),e=S.from_fen(ht.trim()),i,s,r,_,a=new ot(n,{on_pass(){_&&(r=h.zero,e=e.with_grid(_))},on_test_move_(d){return _=e.grid.move_(d,i),!!_},on_test_drag(d){return i=e.grid.on(d),!!i},on_begin(d,c){},on_move(d,c){r=h.make(d,c)},on_shake(d){s=d},on_end(){i=void 0,s=void 0,r=void 0}});H(d=>{if(a._update(d),t.clear(),t.fr("hsl(0, 8%, 15%)",0,0,1080,1920),e.bodies.forEach(([c,u])=>{if(c.body===i)return;let f=0;u.forEach(g=>t.fr(B[c.char],g.x*x-f/2,g.y*x-f/2,f+x-10,f+x-10))}),i){let[c,u]=e.bodies.find(L=>L[0].body===i),f=0,g=0,v=(s==null?void 0:s.x)||0,m=(s==null?void 0:s.y)||0;v+=(r==null?void 0:r.x)||0,m+=(r==null?void 0:r.y)||0;let y=4;u.forEach(L=>t.fr(B[c.char],v+f*100+L.x*x-y/2,m+g*100+L.y*x-y/2,y+x-10,y+x-10))}})};lt(document.getElementById("app"));
