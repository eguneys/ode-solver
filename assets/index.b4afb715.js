var j=Object.defineProperty;var N=(h,t,e)=>t in h?j(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var a=(h,t,e)=>(N(h,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const q=class{constructor(t,e,s){a(this,"ctx");this.width=t,this.height=e,this.canvas=s,this.ctx=s.getContext("2d")}clear(){this.ctx.clearRect(0,0,this.width,this.height)}fr(t,e,s,i,r){this.ctx.fillStyle=t,this.ctx.fillRect(e,s,i,r)}};let k=q;a(k,"make",(t,e,s)=>{let i=document.createElement("canvas");return i.width=t,i.height=e,s.appendChild(i),new q(t,e,i)});const S=h=>{let t,e=0;function s(i){let r=i-(e||i);e=i,r=Math.max(Math.min(r,16),4),h(r),t=requestAnimationFrame(s)}return t=requestAnimationFrame(s),()=>{cancelAnimationFrame(t)}},d=class{constructor(t,e,s){a(this,"x");a(this,"y");a(this,"z");this.x=t,this.y=e,this.z=s}static get unit(){return new d(1,1,1)}static get zero(){return new d(0,0,0)}static get down(){return new d(0,1,0)}static get up(){return new d(0,-1,0)}static get right(){return new d(1,0,0)}static get left(){return new d(-1,0,0)}get vs(){return[this.x,this.y,this.z]}get mul_inverse(){return new d(1/this.x,1/this.y,1/this.z)}get inverse(){return new d(-this.x,-this.y,-this.z)}get half(){return new d(this.x/2,this.y/2,this.z/2)}get length_squared(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?d.zero:this.scale(1/this.length)}get perpendicular(){return new d(-this.y,this.x,this.z)}get clone(){return new d(this.x,this.y,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return d.make(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}distance(t){return this.sub(t).length}scale(t){let{clone:e}=this;return e.scale_in(t)}scale_in(t){return this.x*=t,this.y*=t,this.z*=t,this}add(t){let{clone:e}=this;return e.add_in(t)}add_in(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){let{clone:e}=this;return e.sub_in(t)}sub_in(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mul(t){let{clone:e}=this;return e.mul_in(t)}mul_in(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}div(t){let{clone:e}=this;return e.div_in(t)}div_in(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}set_in(t,e=this.y,s=this.z){return this.x=t,this.y=e,this.z=s,this}copy_in(t){return this.set_in(t.x,t.y,t.z)}};let _=d;a(_,"make",(t,e,s)=>new d(t,e,s));const u=class{constructor(t,e){a(this,"x");a(this,"y");this.x=t,this.y=e}get key(){return[this.x,this.y].join(";")}static get unit(){return new u(1,1)}static get zero(){return new u(0,0)}static get left(){return new u(-1,0)}static get right(){return new u(1,0)}static get up(){return new u(0,-1)}static get down(){return new u(0,1)}get neighbours(){return[u.up,u.down,u.left,u.right].map(t=>t.add(this))}get vs(){return[this.x,this.y]}get mul_inverse(){return new u(1/this.x,1/this.y)}get inverse(){return new u(-this.x,-this.y)}get half(){return new u(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){if(this.length!==0)return this.scale(1/this.length)}get perpendicular(){return new u(-this.y,this.x)}get clone(){return new u(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let e=t.length_squared,s=this.dot(t);return u.make(s*t.x/e,s*t.y/e)}distance(t){return this.sub(t).length}addy(t){return u.make(this.x,this.y+t)}add_angle(t){return u.from_angle(this.angle+t)}scale(t){let{clone:e}=this;return e.scale_in(t)}scale_in(t){return this.x*=t,this.y*=t,this}add(t){let{clone:e}=this;return e.add_in(t)}add_in(t){return this.x+=t.x,this.y+=t.y,this}sub(t){let{clone:e}=this;return e.sub_in(t)}sub_in(t){return this.x-=t.x,this.y-=t.y,this}mul(t){let{clone:e}=this;return e.mul_in(t)}mul_in(t){return this.x*=t.x,this.y*=t.y,this}div(t){let{clone:e}=this;return e.div_in(t)}div_in(t){return this.x/=t.x,this.y/=t.y,this}set_in(t,e=this.y){return this.x=t,this.y=e,this}};let l=u;a(l,"from_key",t=>new u(parseFloat(t.split(";")[0]),parseFloat(t.split(";")[1]))),a(l,"from_angle",t=>new u(Math.cos(t),Math.sin(t))),a(l,"make",(t,e)=>new u(t,e));const f=class{constructor(t){this.vertices=t}static get unit(){return f.make(0,0,1,1)}get vs(){let{x:t,y:e,w:s,h:i}=this;return[t,e,s,i]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return l.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(t=>t.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(t){return f.make(this.x-t,this.y-t,this.w+t,this.h+t)}transform(t){return new f(this.vertices.map(e=>t.mVec2(e)))}};let b=f;a(b,"make",(t,e,s,i)=>new f([l.make(t,e),l.make(t+s,e),l.make(t+s,e+i),l.make(t,e+i)]));const C=class{constructor(t,e,s){a(this,"force");a(this,"position0");this.mass=t,this.position=e,this.velocity=s,this.force=_.zero,this.position0=e}get a(){return this.force.scale(this.w)}get w(){return 1/this.mass}};let v=C;a(v,"make",(t,e,s)=>new C(t,e,s));class X{constructor(t,e,s){a(this,"dt");this.ps=t,this.k=e,this.alpha=s}get lambda(){let t=this.ps.map((e,s)=>e.w*this.Gradient(e,s).length_squared).reduce((e,s)=>e+s);return t===0?0:-this.C/(t+this.alpha/(this.dt*this.dt))}delta_x(t){let e=this.ps[t];return this.Gradient(e,t).scale(this.lambda*e.w)}s_delta_x(t){return this.delta_x(t).scale(this.k)}solve(t){this.dt=t,this.ps.forEach((e,s)=>{e.position.add_in(this.s_delta_x(s))})}}class D extends X{constructor(t,e,s,i,r,o){super([t,e],i,r),this.p1=t,this.p2=e,this.v=s,this.k=i,this.alpha=r,this.no_log=o}get C(){return this.p1.position.add(this.v).sub(this.p2.position).length}Gradient(t,e){return t===this.p2?this.p2.position.sub(this.p1.position.add(this.v)).normalize:_.zero}}class P extends X{constructor(t,e,s,i,r){super([t,e],i,r),this.p1=t,this.p2=e,this.l0=s,this.k=i,this.alpha=r}get C(){return Math.min(0,this.p2.position.sub(this.p1.position).length-this.l0)}Gradient(t,e){let s=t===this.p1?this.p2:this.p1;return t.position.sub(s.position).normalize}}class T{constructor(t,e,s){this.n=t,this.particles=e,this.constraints=s}update(t){let{n:e,particles:s,constraints:i}=this,r=t/e;for(let o=0;o<e;o++)s.forEach(n=>{n.velocity.add_in(n.a.scale(r)),n.position0=n.position,n.position.add_in(n.velocity.scale(r))}),i.forEach(n=>{n.solve(r)}),s.forEach(n=>{n.velocity.copy_in(n.position.sub(n.position0).scale(1/r))})}}function B(h){var t;return h.clientX!==void 0&&h.clientY!==void 0?[h.clientX,h.clientY]:(t=h.targetTouches)!=null&&t[0]?[h.targetTouches[0].clientX,h.targetTouches[0].clientY]:[0,0]}class Y{}a(Y,"init",(t,e=document)=>{const s=p=>{let M=B(p);return M?l.make(M[0],M[1]):l.zero};let{_onDragStart:i,_onDragMove:r,_onDragEnd:o,_onContextMenu:n,_onWheel:m}=t;const g=p=>{i==null||i(s(p),p.buttons===2||p.button===2)},c=p=>{r==null||r(s(p))},x=p=>{o==null||o(s(p))},y=p=>{n&&(p.preventDefault(),n())},z=p=>{m==null||m(Math.sign(p.deltaY))};return e.addEventListener("wheel",z),e.addEventListener("touchstart",g,{passive:!1}),e.addEventListener("mousedown",g,{passive:!1}),e.addEventListener("contextmenu",y),document.addEventListener("mousemove",c),document.addEventListener("mouseup",x),document.addEventListener("touchmove",c),document.addEventListener("touchend",x),()=>{e.removeEventListener("wheel",z),e.removeEventListener("touchstart",g),e.removeEventListener("mousedown",g),e.removeEventListener("contextmenu",y),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",x),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",x)}});const I=(h,t)=>{let{on_hover:e,on_up:s,on_click:i,on_drag:r,on_context:o}=h,n,m,g,c;const x=y=>y&&{...y};return Y.init({...o?{_onContextMenu(){o==null||o()}}:{},_onDragStart(y,z){m=x(n),n={e:y,_right:z},c&&(c==null||c()),c=S(p=>{n?((n.m||g&&n.e.distance(g)>3)&&(n.m=g),r==null||r(n,m),m=x(n)):c==null||c()})},_onDragMove(y){g=y,n||e==null||e(y)},_onDragEnd(){!n||(n.m||i==null||i(n.e,n._right),s==null||s(n.m||n.e,n._right),c==null||c(),c=void 0,n=void 0,g=void 0)}},t)},A=class{constructor(t){a(this,"_bounds");this.$_=t}$clear_bounds(){this._bounds=void 0}get bounds(){return this._bounds||(this._bounds=this.$_.getBoundingClientRect()),this._bounds}get size(){let{bounds:t}=this;return l.make(t.width,t.height)}get orig(){let{bounds:t}=this;return l.make(t.x,t.y)}get_normal_at_abs_pos(t){let{orig:e,size:s}=this;return t.sub(e).div(s)}};let E=A;a(E,"make",t=>new A(t));const H=h=>{document.addEventListener("scroll",h,{capture:!0,passive:!0}),window.addEventListener("resize",h,{passive:!0})};let G=l.make(1080,1920);const K=(h,t)=>h.x1<=t.x&&t.x<=h.x2&&h.y1<=t.y&&t.y<=h.y2,U=h=>_.make(h.x,h.y,0);let w=3,J=l.make(w,w);class O{constructor(t,e){a(this,"_distance_c");a(this,"_drag_c");a(this,"_particles");a(this,"_drag_particle");this.o=t,this.r=e,this._drag_c=[],this._particles=[...Array(w).keys()].flatMap(s=>[...Array(w).keys()].map(i=>{let r=100,o=l.make(s,i),n=o.sub(J.half).mul(l.make(this._r_sub,this._r_sub)),m=b.make(n.x,n.y,this._r_sub,this._r_sub),g=t.add(m.center);return{p:v.make(r,U(g),_.zero),v_sub:o}})),this._distance_c=this._particles.flatMap(s=>this._particles.flatMap(i=>s===i?[]:new D(s.p,i.p,i.p.position.sub(s.p.position),1,0)))}get constraints(){return[...this._drag_c,...this._distance_c]}get particles(){return this._particles.map(t=>t.p)}get _r_sub(){return this.r/w}find_and_save_drag(t){let e=this._particles.find(s=>{let{x:i,y:r}=s.p.position;return K(b.make(i-this._r_sub/2,r-this._r_sub/2,this._r_sub,this._r_sub),t)});return this._drag_particle=e,e}drag_constraint(t){if(!this._drag_particle){this._drag_c=[];return}let e=this._drag_particle,s=v.make(120,t,_.zero);this._drag_c=this._particles.map(i=>new D(s,i.p,i.p.position.sub(e.p.position),.5,1))}collide_constraints(t){let e=this._r_sub/2+t._r_sub/2;return this._particles.flatMap(s=>t._particles.map(i=>new P(s.p,i.p,e,1,0)))}}const F=class{constructor(t){this.bodies=t}get particles(){return this.bodies.flatMap(t=>t.particles)}get constraints(){return[...this.bodies.flatMap(t=>t.constraints),...this._collide_constraints]}get _collide_constraints(){let t=[];for(let e=0;e<this.bodies.length;e++)for(let s=e+1;s<this.bodies.length;s++){let i=this.bodies[e],r=this.bodies[s];t.push(...i.collide_constraints(r))}return t}get xpbd(){return new T(2,this.particles,this.constraints)}find_and_save_drag(t){return this.bodies.forEach(e=>e._drag_particle=void 0),this.bodies.find(e=>e.find_and_save_drag(t))}drag_constraint(t){this.bodies.forEach(e=>e.drag_constraint(t))}update(t){this.xpbd.update(t)}};let L=F;a(L,"from_fen",t=>{let e=new O(l.make(100,100),200),s=new O(l.make(300,300),200);return new F([e,s])});const Q=h=>{let t=k.make(1080,1920,h),e=L.from_fen(""),s,i=E.make(h);I({on_drag(r){if(r.m){let o=i.get_normal_at_abs_pos(r.e).mul(G),n=i.get_normal_at_abs_pos(r.m).mul(G);(s||e.find_and_save_drag(o))&&(s=_.make(n.x,n.y,0))}},on_up(){s=void 0}},h),H(()=>{i.$clear_bounds()}),S(r=>{s&&e.drag_constraint(s),e.update(r),t.clear(),t.fr("hsl(0, 20%, 30%)",0,0,1080,1920),e.particles.forEach(o=>{let{x:n,y:m}=o.position,g="hsl(0, 50%, 50%)";t.fr(g,n,m,10,10)})})};Q(document.getElementById("app"));
